{% extends "base.html" %}
{% block content %}
<main>
    <!-- TODO: change h1 -->
    <h1 style="font-size: 10vw">archive</h1>
    <hr>
    <div class="grid-container">
        {% for i in my_archive %}
        <div class="post">
            <a href="archive/{{ i.url }}">
                <h2 style="margin-bottom: 5px;">{{ i.title }}</h2>
            </a>
            <div style="margin-top: 5px; display: inline-block;">{{ i.date }}</div>
            {% for tag in i.tags %}
            <div style="display: inline-block;" class="tags">
                <h4 class="tag">{{ tag }}</h4>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
    <script>
        window.onload = () => {

            const tags = [...document.querySelectorAll('.tag')]
            let flag = false

            for (let i = 0; i < tags.length; i++) {
                tags[i].onclick = () => {
                    flag = !flag
                    let tag_text = tags[i].innerHTML
                    console.log("clicked tag: " + tag_text)

                    const posts_per_tag = Array.from(tags.map(x => x.parentElement.parentElement))
                    const unique_posts = [... new Set(posts_per_tag)]

                    unique_posts.map(post => {
                        nodes = post.querySelectorAll('.tag')
                        console.log(nodes)

                        for (node of nodes) {
                            node_text = node.innerHTML
                            if (node_text == tag_text) {
                                console.log('here', post)
                                continue
                            }
                        }
                        if (node.includes(node_text) && post.style['display'] != 'none') {
                            post.style['display'] = 'none'
                            console.log('to remove', post)
                        }
                    })
                }
            }
        }
    </script>
</main>
{% endblock %}